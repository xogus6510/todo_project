<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <script src="https://unpkg.com/vue@next"></script>
        <script src="https://unpkg.com/vue-router@4"></script>

        <script src="./todofooter.js"></script>
        <script src="./todoheader.js"></script>
        <script src="./todoinput.js"></script>
        <script src="./todolist.js"></script>

    </head>
    <body>

        <div id="app">

            <todoheader></todoheader>
                <div :class="{'all' : filter === 'all' , 'done' : filter === 'done' , 'undone' : filter === 'undone'}"
                    class="flex justify-between relative overflow-hidden afte:block after:h-[40px] sm:after:h-[45px] after:bg-slate-900 after:absolute after:rounded-lg after:-z-10 after:transition-all">
                    <button @click="filter = 'all'" class="py-2 px-4 sm:text-xl text-gray-400 cursor-pointer">All</button>
                    <button @click="filter = 'done'" class="p-2 px-4 sm:text-xl text-gray-400 cursor-pointer">Done</button>
                    <button @click="filter = 'undone'" class="p-2 px-4 sm:text-xl text-gray-400 cursor-pointer">Undone</button>
        </div>
            <todoinput v-bind:propsinput="inputbtn" v-on:addtodo="addtodo" v-on:editfinish="editfinish"></todoinput>
            <!--todoItems의 데이터를 todolist 컴포넌트로 props-->
            <todolist v-bind:propsdata="todos" v-on:removetodo="removetodo" v-on:edittodo="edittodo"></todolist>
            <todofooter v-on:cleartodo="clearAll"></todofooter>

        </div>

        <script>

            var STORAGE_KEY = 'todolist'
            var todoStorage = {
                fetch: function () {
                    var todos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]')
                    todos.forEach(function (todo, index) {
                        todo.id = index
                    })
                    todoStorage.uid = todos.length
                    return todos
                },
                save: function (todos) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(todos))
                }
            }

            const app = Vue.createApp({
                data() {
                    return {todos: [], inputbtn: false };
                },
                created() {
                    this.todos = todoStorage.fetch();
                },
                watch: {
                    // 옵션을 사용하는 경우, 객체 형식으로 지정합니다.
                    todos: {
                        // 매개 변수로는 속성의 변경 후 값이 들어옵니다.
                        handler: function (todos) {
                            todoStorage.save(todos)
                        },
                        // deep 옵션으로 내부의 데이터까지 감시
                        deep: true
                    }
                },
                methods: {
                    //로컬스토리지에 저장하는 함수
                    addtodo(value) {
                        //현재시간
                        const time = new Date(+new Date() + 3240 * 10000)
                            .toISOString()
                            .replace("T", " ")
                            .replace(/\..*/, '');
                        console.log('addtodo 함수실행' + value);
                        const inputdata = ({
                            id: todoStorage.uid++,
                            item: value,
                            date: time
                        });
                        this
                            .todos
                            .push(JSON.parse(JSON.stringify(inputdata)));
                    },
                    //로컬스토리지에서 삭제하는 함수
                    removetodo(todoItem) {
                        var index = this
                            .todos
                            .indexOf(todoItem)
                        console.log(index + "= index," + todoItem + "= todoItem");
                        this
                            .todos
                            .splice(index, 1)
                    },
                    clearAll() {
                        //로컬스토리지 전체 삭제, todoItems 초기화
                        this.todos = [];
                    },
                    edittodo(todoItem){
                        console.log('edit 함수실행' + todoItem);
                        this.inputbtn = true;
                    },
                    editfinish(todoItem){
                        console.log('editfinish 함수실행' + todoItem);
                        this.inputbtn = false;
                    }
                },
                components: {
                    'Todoheader': Todoheader,
                    'Todoinput': Todoinput,
                    'Todolist': Todolist,
                    'Todofooter': Todofooter
                }
            });

            app.mount('#app')
        </script>

    </body>
</html>
<!-- https://code-hoon.tistory.com/194 글 제목 [ Vue.js ] LocalStorage 이용하는 방법,
예제-->
<!-- https://nykim.work/75 [Vue/Vuex] 뷰 실습 - Todo 웹앱 만들기 -->